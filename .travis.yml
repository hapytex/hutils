sudo: false
os:
- linux
language: haskell
cache:
  directories:
  - "$HOME/.stack"
before_install:
- sudo add-apt-repository -y ppa:hvr/ghc
- sudo apt-get update
- sudo apt-get install cabal-install-3.0
- mkdir -p ~/.local/bin
- export PATH=$HOME/.local/bin:$PATH
- travis_retry curl -L https://get.haskellstack.org/stable/linux-x86_64.tar.gz | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'
install:
- stack build --ghc-options='-Wall -Werror'
- stack haddock
script:
- "! grep -E -i '[?][?][?]|TODO' $(find src -iname '*.hs')"
- "! stack haddock --force-dirty 2>&1 | grep -P '^\\s*[0-9]{1,2}%'"
- stack --no-terminal --skip-ghc-check test
- curl -sSL https://raw.github.com/ndmitchell/hlint/master/misc/run.sh | sh -s .
deploy:
- provider: script
  script: bash deploy.sh "$HACKAGE_USER" "$HACKAGE_PASSWORD"
  on:
    tags: true
- provider: pages
  local_dir: "$(stack path --local-doc-root)"
  skip_cleanup: true
  github_token: "$GITHUB_TOKEN"
  keep_history: true
  on:
    tags: true
env:
  global:
  - secure: WheZbg3uLYY1oMbWCldOokSnomTUe5zSXDxf4OfIIDTfHxYTfhZF5tu1x7ujACJumXNlmkj7lxQXEHJb9j07YZ3SmOtulh8v0/SOg1D0Jfyu4vco63EBR8hrD6jFKHsXZqb0jeP4pLjB1xFqoY4MxP5MfNr0SWXgCD77sz2QrqNyvmRxKrFrY/WuuFw+eNlM9RR81zrv2LOA2rLmdPCgIXi69TVt6wUcyCvWliuyGykKAZmr1d8p8za7EhalKOVlKEzg2YRT6T0qbvXc75sYxZFTwkr6aFLWFjhtkwgwxKhXzeG0mwCv6eA+kJYoNizKGCQvzVj5mC3LoyEfNY11p7MtB2M2CHRyl9jM49ACNMKAEmdh99JfRYPOKOMPT+cqfdIw0IIXFqSOdzTlSjwR7z00EYacI/Cxfo1x/NB5yDSXanz+5NTf23v6ePDl60AO4Pubvy+Osx/nxi3hQCyHGfo999Xw4IBVOrs54JMCx2FuRl7vX7v2IFbFw2fsK7Z9fVLCXg6aspSqTrULaHUGX4Fz3tc1PeK/p9Vu7F6DEY7x8ghM5sKKKKR6L/e7/3z0h54mQXkf4jLErU5Xg3AIo42//EAaOQu4s6aYwPv0CFVQrzWKaJNgRP0hbdTZj4ReEpJR3Ci9wOJIMTjTLR/mK9R1Vn1lQHyGDFFlEoYzKDk=
  - secure: A2ROc8Lb+9mBjZc0vELBMOeP02dnK7bw0fxqTf2ATcIbXtQTrif9fcl0giEI2h23o98y3abOejKktkvfiouvUDOlI3Xihkx0XbuOzFC/osNC3ZgmD1z7ogSPWoCCKyaYAt+OlMdQF/p38dmIlHAMv29bvtH5jlJSY+bZX12tRA+Fliw95ONvfDa6aFYqE7rAwfNzgg4M/XIoy9FMQAyv62ddxQnIRiANFrrkz3TOptbV0LrLHSjazBWz4ZIHK3cWFj4t2Zn9cMy5f/3O6YxEJTbluf8fWXfvphqwpzu2UUyr4xGm5QBHX2kw+g8ZN6jztNyLqGGjFWjoYg6k2oO9uDJz1POFctgt6XQy7gE1AEUuXymcrgnddZVhNaA7uaaUoZSfd4MBGZlXTSqFYDvXuMJCssMipoyZJJZCi2/qkt2gr2uvqOVo0klqW2Shv3ZlTIun2ateCFlOZhQu7LOSb1MvlMveD//7ZmWzL2oyacqZSN5uEaSzfDnF572g5dluRXnjFpKwjuh0YeE0o30EX/24XactmStCxYn1cnl81clJwVgZmZ4WgntGRaTiJDvS070Hz2/otRpuR2Myuqgu4+rsmlCB9+ga05U2iSNXnJVFHmF88rTh67/CzAckfX6Q8TxlrKm8Iv/PDRQX8KDAtnRyx6XqSI2JPEnzZxMT7sM=
  - secure: a2fWymqkpeNffmqPv/uCpBpboGilvFfeSHtIFInUm9oMxjWKZzjdK+Gd6CQs+RBBxYBqEx94l++ZCf2T0A6IJR0q/vqFixKwnTdJY4oRER0e207xBnb8b9yERKuKDeZ9aw2ETMFMNrYO2yWUbdHjW6SisEmMvOI2GS5rNiiSY/gAvbt72JjMO9PN+0zLj0NruvXR+Lu+T499QXPl+qIEbexGFaBXdJ5l/vNaBN8aFF6u67rVfq49KIAKzGPg7oHmvG7cUUlXue/dfSo0Z5JvexOLzdbb5cVBfkNWidWRyWobE3QUigBlCgZVJ82VQMYr/51/bWohkYN9yBJzJuYAXaqrZyqqMadRsjm8B4+BGZ6hh91oZNGmJ1Mcs4HZDsf3vW2qVeVAO3C//xLFCEwRzuiPoER5xzNZ4VF1qlEJUqJX01X/XJXmtd/Hxx4FcIka8/FJTlzDYn3kShTq7+CY9hMcabUZ8OV0QH+shM0O2XuW8zMAm3/e89dzTev9uIjmsc3FJfD60OXNdJzIY6bwFDzfl6zEGZY4R9AnfbPDXV3AbSZODthEb7XHaxjJk9eVLHA8NB9rMOzusWNuGpJSGT5q8uBMtJyIJn3/Q/EmDtfV3N41x0outetmT2XhJbZjO1iwLOkerhDKwm/EXWFeeuqC8/wtusHc37AK3xsPBTk=
